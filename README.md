# SQL Audit Tool (OpenGauss Standards)

A powerful, automated SQL compliance scanner designed for **MyBatis XML Mapper** files. This tool helps developers enforce **OpenGauss SQL Development Standards** by statically analyzing SQL statements extracted from XML files.

## üöÄ Key Features

- **18 Built-in OpenGauss Rules**: Covers standard sections 3.3 (WHERE), 3.4 (SELECT), 3.6 (UPDATE), 3.7 (DELETE), 3.8 (Joins), and 3.9 (Subqueries).
- **MyBatis Safety**: Detects potential SQL injection risks (`${}`).
- **Custom Rule Support**: Upload a Word document (.docx) to dynamically load custom regex-based rules.
- **Modern Tech Stack**: Built with Java 21, Spring Boot 3.4, and a high-performance Vanilla JS/Vite frontend.
- **Visual Reports**: Interactive dashboard to filter violations by Severity (ERROR, WARNING, INFO) and Category.

## üõ† Tech Stack

- **Backend**:
    - Java 21 (LTS) with Virtual Threads support
    - Spring Boot 3.4.1
    - MyBatis Parsing (DOM + Regex)
    - SQLite (Embedded, no installation required)
- **Frontend**:
    - Vite 6
    - Vanilla JavaScript (ES Module)
    - CSS3 (Modern features)
- **DevOps**:
    - Maven (Build)
    - Shell Scripting (`start.sh`)

## üèÅ Getting Started

### Prerequisites

- **Java 21** or higher
- **Node.js 18** or higher
- **Maven 3.8+**

### Quick Start

We provide a one-click startup script for macOS/Linux:

```bash
chmod +x start.sh
./start.sh
```

This will:
1. Kill any existing processes on ports 8080 (Backend) and 5174 (Frontend).
2. Clean and compile the backend.
3. Start the Spring Boot backend in the background.
4. Start the Vite frontend in the background.

Access the application at: **http://localhost:5174**

### Manual Setup

**Backend:**
```bash
cd backend
mvn clean spring-boot:run
```
*(Server listens on port 8080)*

**Frontend:**
```bash
cd frontend
npm install
npm run dev -- --port 5174
```
*(Client available at http://localhost:5174)*

## üèó Architecture

### Backend Parsing Flow
1. **Scanning**: `ScanController` defines the `/api/scan` endpoint receiving a directory path.
2. **File Discovery**: `ScanService` recursively finds all `.xml` files.
3. **XML Parsing**: `MyBatisMapperParser` (refactored for Clean Code) extracts SQL statements using DOM.
   - Handles `<include>`, `<where>`, and other dynamic tags.
   - Cleans SQL (comments, whitespace, XML entities).
4. **Rule Engine**: `RuleService` applies rules to each `SqlFragment`.
   - **Built-in Rules**: Java-based `SqlChecker` implementations (e.g., `NullComparisonChecker`).
   - **Regex Rules**: Pattern matching for custom rules.
5. **Reporting**: Returns a `ScanReport` with list of `Violation`s.

### Frontend Structure
- `main.js`: Core logic for API interaction and DOM manipulation.
- `style.css`: Modern styling variables and component classes.
- **Reactive UI**: Updates rule lists and scan results dynamically without a heavy framework.

## üìè Supported Rules (OpenGauss)

| Section | Rule | Sev | Description |
|---|---|---|---|
| **3.3.1** | `NULL_COMPARISON` | üî¥ | Use `IS NULL` instead of `= NULL` |
| **3.3.3** | `WHERE_FUNCTION` | üü° | Avoid functions in WHERE clauses (index invalidation) |
| **3.3.4** | `NOT_EQUAL_OPS` | üü° | Avoid `!=`, `<>` (index invalidation) |
| **3.3.5** | `LIKE_PERCENT` | üü° | Avoid `LIKE '%...'` (index invalidation) |
| **3.4.1** | `NO_SELECT_STAR` | üî¥ | Explicitly list columns instead of `SELECT *` |
| **3.4.4** | `UNION_ALL` | üü° | Prefer `UNION ALL` over `UNION` |
| **3.8.3** | `IMPLICIT_JOIN` | üî¥ | Use explicit `JOIN` syntax, not comma-separated tables |
| **MyBatis**| `SQL_INJECTION` | üî¥ | Use `#{}` instead of `${}` |
| ... | *+10 more* | | |

## ‚öôÔ∏è Configuration

- **Backend Port**: 8080 (Default)
- **Frontend Port**: 5174
- **Database**: In-memory SQLite (`jdbc:sqlite::memory:`)

To add custom rules, use the "Upload Rules" button in the UI and provide a `.docx` file following the template structure.

## ‚ùì Troubleshooting

**Q: Port 8080 is already in use?**
A: Use `./start.sh` which automatically kills the process, or manually run `lsof -ti:8080 | xargs kill -9`.

**Q: Frontend cannot connect to Backend?**
A: Ensure the backend is running. Open `http://localhost:8080/api/rules` in your browser to verify API availability.

**Q: Compilation error "invalid source release: 21"?**
A: Ensure you have JDK 21 installed and `JAVA_HOME` is set correctly. Check with `java -version`.

---
*Generated by Antigravity Agent*
